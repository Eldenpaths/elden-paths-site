<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Elden Pathsâ„¢ â€” Dungeons & Vaults</title>
  <style>
    body { font-family: monospace; background: #f4f4f4; padding: 2em; }
    #out { white-space: pre-wrap; padding: 1em; background: #eee; border-radius: 6px; margin-bottom: 1em; max-width: 700px; }
    button { margin: 4px; }
  </style>
</head>
<body>

<h1>ğŸ“– Elden Pathsâ„¢</h1>
<div id="out">Loading...</div>

<button onclick="move('north')">â¬†ï¸ Go North</button>
<button onclick="move('south')">â¬‡ï¸ Go South</button>
<button onclick="move('east')">â¡ï¸ Go East</button>
<button onclick="move('west')">â¬…ï¸ Go West</button><br>
<button onclick="fight()">âš”ï¸ Fight</button>
<button onclick="rest()">ğŸ›Œ Rest</button>
<button onclick="shop()">ğŸª Town Action</button>
<button onclick="craft()">ğŸ›  Craft</button>
<button onclick="showInventory()">ğŸ’ Inventory</button>
<button onclick="showJournal()">ğŸ““ Journal</button>
<button onclick="showQuests()">ğŸ“œ Quests</button>

<script>
const api = "https://player-save.pationandcamp.workers.dev";
const name = new URLSearchParams(location.search).get("name") || prompt("Enter your name:");
let player = null;

const dungeonTiles = ["C4", "D5"];
const vaultTile = "E5";

function hasItem(item) {
  return player.inventory.includes(item);
}

function randomEvent(tile) {
  const roll = Math.random();
  if (roll < 0.25) {
    player.inventory.push("Gold Nugget");
    return `ğŸ“¦ You find a hidden stash: Gold Nugget!`;
  } else if (roll < 0.5) {
    const dmg = Math.floor(Math.random() * 4) + 1;
    player.hp -= dmg;
    return `ğŸ’¥ A trap! You lose ${dmg} HP.`;
  } else if (roll < 0.75) {
    player.hp += 2;
    if (player.hp > player.maxHp) player.hp = player.maxHp;
    return `âœ¨ You find a glowing spring and heal 2 HP.`;
  } else {
    player.inventory.push("Strange Key");
    return `ğŸ— You find a Strange Key...`;
  }
}

function vaultAccess() {
  if (!hasItem("Steel Core")) return "ğŸ”’ The vault is sealed tight. You need a Steel Core.";
  player.inventory.push("Obsidian Blade");
  player.str += 5;
  player.inventory.splice(player.inventory.indexOf("Steel Core"), 1);
  player.gear.weapon = "Obsidian Blade";
  return "ğŸ”“ The Steel Core fits! You unlock the vault and claim the Obsidian Blade (+5 STR).";
}

function checkDungeonEvents(tile) {
  if (tile === vaultTile) return vaultAccess();
  if (dungeonTiles.includes(tile)) return randomEvent(tile);
  return "";
}

// INSERT INTO move() logic like this:
async function move(dir) {
  let [x, y] = player.tile.split(',').map(Number);
  if (dir === 'north') y++;
  if (dir === 'south') y--;
  if (dir === 'east') x++;
  if (dir === 'west') x--;
  player.tile = `${x},${y}`;

  let log = `ğŸš¶ You travel ${dir.toUpperCase()} to tile ${player.tile}`;

  const dungeonLog = checkDungeonEvents(player.tile);
  if (dungeonLog) log += `\nğŸ° Dungeon Event: ${dungeonLog}`;

  await savePlayer();
  update(log);
}

// Add this near the top of script block:
async function savePlayer() {
  await fetch(`${api}/savePlayer`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(player)
  });
}

function update(log = "") {
  const status =
    `ğŸ§ ${player.name} | â¤ï¸ ${player.hp}/${player.maxHp} | âš”ï¸ STR: ${player.str} ${player.gear.weapon ? `(w/ ${player.gear.weapon})` : ''}\n` +
    `ğŸ–ï¸ XP: ${player.xp} | Level: ${player.level} | ğŸ’° Gold: ${player.gold ?? 0}\n` +
    `ğŸ“ Tile: ${player.tile}\nğŸ’ ${player.inventory.join(', ') || 'Empty'}`;
  document.getElementById('out').textContent = `${log}\n\n${status}`;
}

// (Rest of your RPG system here: fight, shop, crafting, journal, quests, etc.)
</script>

</body>
</html>
