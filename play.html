<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Elden Paths™ — Crafting & Resources</title>
  <style>
    body { font-family: monospace; background: #f4f4f4; padding: 2em; }
    #out { white-space: pre-wrap; padding: 1em; background: #eee; border-radius: 6px; margin-bottom: 1em; max-width: 700px; }
    button { margin: 4px; }
  </style>
</head>
<body>

<h1>📖 Elden Paths™</h1>
<div id="out">Loading...</div>

<button onclick="move('north')">⬆️ Go North</button>
<button onclick="move('south')">⬇️ Go South</button>
<button onclick="move('east')">➡️ Go East</button>
<button onclick="move('west')">⬅️ Go West</button><br>
<button onclick="fight()">⚔️ Fight</button>
<button onclick="rest()">🛌 Rest</button>
<button onclick="shop()">🏪 Town Action</button>
<button onclick="craft()">🛠 Craft</button>
<button onclick="showInventory()">🎒 Inventory</button>
<button onclick="showJournal()">📓 Journal</button>
<button onclick="showQuests()">📜 Quests</button>

<script>
const api = "https://player-save.pationandcamp.workers.dev";
const name = new URLSearchParams(location.search).get("name") || prompt("Enter your name:");
let player = null;

const resourceByTile = {
  "B4": "Herb",
  "C1": "Wood",
  "D1": "Ore"
};

function gainResource(tile) {
  const resource = resourceByTile[tile];
  if (resource && !player.gathered?.includes(tile)) {
    player.inventory.push(resource);
    player.gathered = player.gathered || [];
    player.gathered.push(tile);
    return `🌾 You gather: ${resource}`;
  }
  return "";
}

function craft() {
  const inv = player.inventory;
  let msg = "🛠 Crafting Options:\n";

  const has = (item) => inv.filter(i => i === item).length;
  const remove = (item, count = 1) => {
    for (let i = 0; i < count; i++) {
      const iIndex = inv.indexOf(item);
      if (iIndex !== -1) inv.splice(iIndex, 1);
    }
  };

  let options = [];

  if (has("Herb") >= 2) options.push("1. Herb + Herb → Healing Brew");
  if (has("Wood") >= 1 && has("Ore") >= 1) options.push("2. Wood + Ore → Iron Blade (+3 STR)");
  if (has("Ore") >= 2) options.push("3. Ore + Ore → Steel Core (reserved)");

  if (!options.length) return alert("❌ You don't have enough materials to craft anything.");

  msg += options.join("\n");
  const choice = prompt(msg + "\n\nEnter number to craft:");

  if (choice === "1" && has("Herb") >= 2) {
    remove("Herb", 2);
    player.inventory.push("Healing Brew");
    alert("✅ Crafted: Healing Brew (heals 6 HP)");
  } else if (choice === "2" && has("Wood") && has("Ore")) {
    remove("Wood");
    remove("Ore");
    if (player.gear.weapon) {
      if (player.gear.weapon === "Rusty Sword") player.str -= 2;
      if (player.gear.weapon === "Steel Sword") player.str -= 3;
      if (player.gear.weapon === "Darkblade") player.str -= 4;
    }
    player.gear.weapon = "Iron Blade";
    player.str += 3;
    alert("🛡️ You craft and equip: Iron Blade (+3 STR)");
  } else if (choice === "3" && has("Ore") >= 2) {
    remove("Ore", 2);
    player.inventory.push("Steel Core");
    alert("🔩 Crafted: Steel Core (for future use)");
  } else {
    alert("❌ Invalid choice or missing items.");
  }

  savePlayer();
  update("🛠 Crafting complete.");
}

// All previous functions from last version stay the same (move, fight, shop, etc.)
// Use the previous "Phase 15" version and insert `gainResource(player.tile)` into move() like this:

async function move(dir) {
  let [x, y] = player.tile.split(',').map(Number);
  if (dir === 'north') y++;
  if (dir === 'south') y--;
  if (dir === 'east') x++;
  if (dir === 'west') x--;
  player.tile = `${x},${y}`;

  let log = `🚶 You travel ${dir.toUpperCase()} to tile ${player.tile}`;

  const lore = loreByTile?.[player.tile];
  if (lore && !player.journal?.includes(lore)) {
    player.journal.push(lore);
    log += `\n📜 New Lore: ${lore}`;
  }

  const quest = questByTile?.[player.tile];
  if (quest && !player.quests?.includes(quest)) {
    player.quests.push(quest);
    log += `\n🆕 Quest Found: ${quest}`;
  }

  const gathered = gainResource(player.tile);
  if (gathered) log += `\n${gathered}`;

  await savePlayer();
  update(log);
}

// ... rest of your game remains unchanged (combat, inventory, quests, etc.)
</script>

</body>
</html>

</body>
</html>
