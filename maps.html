
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Elden Paths‚Ñ¢ | World Map + Fog</title>
  <style>
    body { font-family: serif; padding: 2rem; background: #eae7df; }
    h1 { margin-bottom: 1rem; }
    #mapCanvas { position: relative; width: 100%; height: 1000px; background-color: #d3e4c0; border: 2px solid #666; }
    .trail-line { position: absolute; height: 4px; border-radius: 2px; }
    .historic { background: goldenrod; }
    .player-made { background: saddlebrown; }
    .animal { background: gray; opacity: 0.5; }
    .fog-tile {
      position: absolute;
      width: 100px;
      height: 100px;
      background-color: rgba(30,30,30,0.75);
      z-index: 3;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <h1>üåç Elden Paths‚Ñ¢ - Fog of Discovery‚Ñ¢ Map</h1>
  <div id="mapCanvas"></div>

  <script>
    const tileSize = 100;
    const offsetX = 100;
    const offsetY = 100;

    function tileToCoord(tileId) {
      const match = tileId.match(/tile_(\d+)_(-?\d+)/);
      if (!match) return [0, 0];
      const lat = parseInt(match[1]), lon = parseInt(match[2]);
      const x = (lon + 180) * 2;
      const y = (90 - lat) * 2;
      return [x + offsetX, y + offsetY];
    }

    fetch('tile_index.json')
      .then(res => res.json())
      .then(index => {
        const canvas = document.getElementById('mapCanvas');
        const explored = Object.keys(index.active_tiles || {});
        const fogged = index.inactive_tiles || [];

        [...explored, ...fogged].forEach(tile => {
          const [x, y] = tileToCoord(tile);
          if (fogged.includes(tile)) {
            const fog = document.createElement('div');
            fog.className = 'fog-tile';
            fog.style.left = x + 'px';
            fog.style.top = y + 'px';
            canvas.appendChild(fog);
          }
        });
      });

    fetch('trails.json')
      .then(res => res.json())
      .then(data => {
        const canvas = document.getElementById('mapCanvas');

        data.trails.forEach(trail => {
          for (let i = 0; i < trail.tiles.length - 1; i++) {
            const [x1, y1] = tileToCoord(trail.tiles[i]);
            const [x2, y2] = tileToCoord(trail.tiles[i + 1]);
            const line = document.createElement('div');
            line.className = `trail-line ${trail.type}`;
            line.style.left = Math.min(x1, x2) + 'px';
            line.style.top = Math.min(y1, y2) + 'px';
            line.style.width = Math.max(4, Math.abs(x2 - x1)) + 'px';
            line.style.height = Math.max(4, Math.abs(y2 - y1)) + 'px';
            canvas.appendChild(line);
          }
        });
      });
  </script>
</body>
</html>
