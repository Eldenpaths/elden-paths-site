
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Elden Paths‚Ñ¢ | Map + Hover Info</title>
  <style>
    body { font-family: serif; padding: 2rem; background: #eae7df; }
    #mapCanvas { position: relative; width: 100%; height: 1000px; background-color: #d3e4c0; border: 2px solid #666; }
    .tile-terrain {
      position: absolute;
      width: 100px;
      height: 100px;
      opacity: 0.5;
      z-index: 1;
    }
    .forest { background-color: darkgreen; }
    .coast { background-color: lightblue; }
    .swamp { background-color: teal; }
    .mountain { background-color: gray; }
    .plains { background-color: khaki; }
    .highlands { background-color: sienna; }

    .trail-line { position: absolute; height: 4px; border-radius: 2px; z-index: 2; }
    .historic { background: goldenrod; }
    .player-made { background: saddlebrown; }
    .animal { background: gray; opacity: 0.5; }

    .fog-tile {
      position: absolute;
      width: 100px;
      height: 100px;
      background-color: rgba(30,30,30,0.75);
      z-index: 3;
      pointer-events: none;
    }

    .tooltip {
      position: absolute;
      padding: 6px 10px;
      background: #fff;
      border: 1px solid #ccc;
      font-size: 0.9rem;
      pointer-events: none;
      z-index: 100;
      display: none;
    }
  </style>
</head>
<body>
  <h1>üåç Elden Paths‚Ñ¢ - Map with Terrain + Hover Info</h1>
  <div id="mapCanvas"></div>
  <div id="tooltip" class="tooltip"></div>

  <script>
    const tileSize = 100;
    const offsetX = 100;
    const offsetY = 100;

    const canvas = document.getElementById('mapCanvas');
    const tooltip = document.getElementById('tooltip');

    function tileToCoord(tileId) {
      const match = tileId.match(/tile_(\d+)_(-?\d+)/);
      if (!match) return [0, 0];
      const lat = parseInt(match[1]), lon = parseInt(match[2]);
      const x = (lon + 180) * 2;
      const y = (90 - lat) * 2;
      return [x + offsetX, y + offsetY];
    }

    Promise.all([
      fetch('tile_meta.json').then(r => r.json()),
      fetch('tile_index.json').then(r => r.json()),
      fetch('trails.json').then(r => r.json())
    ]).then(([meta, index, trails]) => {
      const explored = Object.keys(index.active_tiles || {});
      const fogged = index.inactive_tiles || [];

      // TERRAIN TILES + HOVER INFO
      for (const tile in meta) {
        const [x, y] = tileToCoord(tile);
        const terrain = meta[tile].terrain;

        const div = document.createElement('div');
        div.className = `tile-terrain ${terrain}`;
        div.style.left = x + 'px';
        div.style.top = y + 'px';
        div.dataset.tile = tile;
        div.dataset.terrain = terrain;
        div.dataset.status = fogged.includes(tile) ? "unexplored" : "explored";

        div.addEventListener('mouseenter', e => {
          tooltip.style.display = 'block';
          tooltip.innerHTML = `<strong>${div.dataset.tile}</strong><br>Terrain: ${div.dataset.terrain}<br>Status: ${div.dataset.status}`;
        });

        div.addEventListener('mousemove', e => {
          tooltip.style.left = (e.pageX + 10) + 'px';
          tooltip.style.top = (e.pageY - 20) + 'px';
        });

        div.addEventListener('mouseleave', () => {
          tooltip.style.display = 'none';
        });

        canvas.appendChild(div);
      }

      // FOG
      [...explored, ...fogged].forEach(tile => {
        const [x, y] = tileToCoord(tile);
        if (fogged.includes(tile)) {
          const fog = document.createElement('div');
          fog.className = 'fog-tile';
          fog.style.left = x + 'px';
          fog.style.top = y + 'px';
          canvas.appendChild(fog);
        }
      });

      // TRAILS
      trails.trails.forEach(trail => {
        for (let i = 0; i < trail.tiles.length - 1; i++) {
          const [x1, y1] = tileToCoord(trail.tiles[i]);
          const [x2, y2] = tileToCoord(trail.tiles[i + 1]);
          const line = document.createElement('div');
          line.className = `trail-line ${trail.type}`;
          line.style.left = Math.min(x1, x2) + 'px';
          line.style.top = Math.min(y1, y2) + 'px';
          line.style.width = Math.max(4, Math.abs(x2 - x1)) + 'px';
          line.style.height = Math.max(4, Math.abs(y2 - y1)) + 'px';
          canvas.appendChild(line);
        }
      });
    });
  </script>
</body>
</html>
