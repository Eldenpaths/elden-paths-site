<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Elden Paths â€“ World Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    html, body, #map { margin: 0; height: 100%; width: 100%; background: #000; }
    .marker-shrine {
      background-color: gold;
      border-radius: 50%;
      width: 12px;
      height: 12px;
      border: 1px solid #444;
    }
    .marker-player {
      background-color: cyan;
      border: 2px solid #fff;
      border-radius: 50%;
      width: 14px;
      height: 14px;
    }
    .marker-echo {
      background-color: purple;
      border: 2px solid #fff;
      border-radius: 50%;
      width: 14px;
      height: 14px;
    }
  </style>
</head>
<body>
<div id="map"></div>
<script>
  const map = L.map('map', {
    minZoom: 1,
    maxZoom: 3,
    crs: L.CRS.Simple
  }).setView([0, 0], 1);

  const bounds = [[0,0], [1024*3, 1024*3]];
  const tileLayer = L.tileLayer('./map_tiles/z1/{x}_{y}.png', {
    tileSize: 1024,
    noWrap: true,
    bounds: bounds,
    errorTileUrl: ''
  }).addTo(map);

  // Load fog overlay
  fetch("./data/tile_index.json")
    .then(res => res.json())
    .then(tileIndex => {
      for (const key in tileIndex) {
        const [x, y] = key.split("_").map(Number);
        const tile = tileIndex[key];
        if (!tile.fog_cleared) {
          const x1 = x * 1024, y1 = y * 1024;
          const x2 = x1 + 1024, y2 = y1 + 1024;
          L.rectangle([[y1, x1], [y2, x2]], {
            color: "#000",
            fillColor: "#000",
            fillOpacity: 0.65,
            weight: 0
          }).addTo(map);
        }
      }
    });

  // Load shrine markers
  fetch("./data/tile_markers.json")
    .then(res => res.json())
    .then(data => {
      for (const tile in data) {
        for (const marker of data[tile]) {
          if (marker.type === "shrine") {
            const [x, y] = tile.split("_").map(Number);
            const px = x * 1024 + 512;
            const py = y * 1024 + 512;
            const icon = L.divIcon({ className: 'marker-shrine' });
            L.marker([py, px], { icon }).addTo(map).bindPopup(marker.name || "Shrine");
          }
        }
      }
    });

  // Load player markers
  fetch("./data/players.json")
    .then(res => res.json())
    .then(players => {
      for (const name in players) {
        const player = players[name];
        const [x, y] = player.tile.split("_").map(Number);
        const px = x * 1024 + 512;
        const py = y * 1024 + 512;
        const iconClass = player.is_echo ? 'marker-echo' : 'marker-player';
        const icon = L.divIcon({ className: iconClass });
        const label = `${name} (HP: ${player.hp}, XP: ${player.xp})`;
        L.marker([py, px], { icon }).addTo(map).bindPopup(label);
      }
    });
</script>
</body>
</html>
