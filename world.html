<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Elden Pathsâ„¢ â€” World Codex</title>
  <link id="themeStylesheet" rel="stylesheet" href="style.css" />
  <script defer src="theme-toggle.js"></script>
</head>
<body>
  <div class="container">
    <div style="text-align:right; margin-bottom: 1em;">
      <label for="themeSelect">ğŸ¨ Theme:</label>
      <select id="themeSelect">
        <option value="default">Parchment</option>
        <option value="dark">Dark Mode</option>
        <option value="frazetta">Frazetta Mode</option>
        <option value="snow">Winter Fog</option>
        <option value="fog">Fog</option>
        <option value="rain">Rain</option>
        <option value="heat">Heat</option>
        <option value="glow">Glow</option>
      </select>
    </div>

    <h1>ğŸŒ Elden Pathsâ„¢ â€” World Sketch Codex</h1>
    <p>All known terrain, structures, relics, and scenes are recorded here.</p>

    <button onclick="exportCodex()" style="margin-top: 1em;">ğŸ“¤ Export Codex JSON</button>

    <div id="worldCodex" style="display: grid; gap: 1.5em; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); margin-top: 2em;"></div>

    <script>
      function exportCodex() {
        const worldData = JSON.parse(localStorage.getItem("worldSketches") || "{}");
        const blob = new Blob([JSON.stringify(worldData, null, 2)], { type: "application/json" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "elden_world_codex.json";
        link.click();
      }

      document.addEventListener("DOMContentLoaded", () => {
        const codex = document.getElementById("worldCodex");
        const worldData = JSON.parse(localStorage.getItem("worldSketches") || "{}");

        const grouped = { structure: [], relic: [], scene: [], terrain: [] };

        for (const key in worldData) {
          const entry = worldData[key];
          if (grouped[entry.type]) {
            grouped[entry.type].push(entry);
          }
        }

        for (const type of ["structure", "relic", "scene", "terrain"]) {
          if (grouped[type].length) {
            const section = document.createElement("div");
            section.innerHTML = `<h2 style="grid-column: span 2;">ğŸ”¸ ${type.charAt(0).toUpperCase() + type.slice(1)}s</h2>`;
            codex.appendChild(section);

            grouped[type].forEach(entry => {
              const card = document.createElement("div");
              card.style.border = "1px solid #ccc";
              card.style.borderRadius = "8px";
              card.style.padding = "1em";
              card.style.background = "white";

              const date = new Date(entry.createdAt).toLocaleString();

              card.innerHTML = `
                <strong>${entry.name}</strong><br/>
                <img src="${entry.image}" alt="${entry.name}" style="width:100%; border-radius: 4px; margin: 0.5em 0;" />
                <div style="font-size: 0.85em; margin-bottom: 0.5em;">ğŸ§™ ${entry.createdBy} | ğŸ•’ ${date}</div>
                <details><summary>Prompt</summary><p style="font-size: 0.9em;">${entry.prompt}</p></details>
              `;
              codex.appendChild(card);
            });
          }
        }
      });
    </script>
  </div>
</body>
</html>
