
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Elden Paths ‚Äî Master Map</title>
  <style>
    body {
      font-family: 'Georgia', serif;
      background-color: #f3efe2;
      color: #2d1b00;
      text-align: center;
      padding: 1rem;
    }
    #master-map {
      display: grid;
      gap: 1px;
      margin: 1rem auto;
      width: fit-content;
    }
    .tile {
      width: 20px;
      height: 20px;
      background-color: #d7ceb2;
      border: 1px solid #aaa;
      position: relative;
    }
    .tile.fogged {
      background-color: #999;
    }
    .tile img {
      width: 100%;
      height: 100%;
      opacity: 0.25;
      object-fit: cover;
    }
    .marker {
      position: absolute;
      font-size: 10px;
      bottom: 0;
      right: 0;
    }
    .legend {
      margin-top: 1rem;
    }
    .btn {
      margin: 4px;
      padding: 6px 12px;
      background: #e0d8c3;
      border: 1px solid #888;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>üó∫Ô∏è Elden Paths ‚Äî Master Map</h1>
  <div>
    <button class="btn" onclick="toggleFog()">Toggle Fog</button>
    <button class="btn" onclick="toggleLore()">Toggle Lore</button>
    <button class="btn" onclick="toggleStructures()">Toggle Structures</button>
    <button class="btn" onclick="location.href='play.html'">Return to Game</button>
  </div>

  <div id="master-map"></div>
  <div class="legend">
    <p>‚¨õ Fogged | üè∞ Fort | üèö Ruin | ‚ú® Relic</p>
  </div>

  <script>
    let terrainMeta = {};
    let fogData = {};
    let loreData = {};
    let structuresData = {};
    let relicsData = {};
    let weatherData = {};
    let fogEnabled = true;
    let loreEnabled = true;
    let structureEnabled = true;

    async function loadMap() {
      terrainMeta = (await fetch('meta.json').then(r => r.json())).tiles || {};
      try {
        fogData = (await fetch('fog.json').then(r => r.json()));
      } catch { fogData = {}; }
      try {
        loreData = await fetch('tile_lore.json').then(r => r.json());
      } catch { loreData = {}; }
      try {
        structuresData = await fetch('structures.json').then(r => r.json());
      } catch { structuresData = {}; }

      try { relicsData = await fetch("relics.json").then(r => r.json()); } catch { relicsData = {}; }
      try { weatherData = await fetch("weather.json").then(r => r.json()); } catch { weatherData = {}; }
      buildMasterMap();
    }

    function buildMasterMap() {
      const container = document.getElementById('master-map');
      container.innerHTML = '';
      container.style.gridTemplateColumns = `repeat(40, 1fr)`;

      for (let y = -20; y < 20; y++) {
        for (let x = -20; x < 20; x++) {
          const coord = `${x},${y}`;
          const tileData = terrainMeta[coord] || {};
          const tile = document.createElement('div');
          tile.className = 'tile';

          const discovered = Object.values(fogData).some(p => p.discovered?.includes(coord));

          if (fogEnabled && !discovered) tile.classList.add('fogged');

          if (tileData.sketch && (!fogEnabled || discovered)) {
            const img = document.createElement('img');
            img.src = `/assets/img/tiles/${tileData.sketch}`;
            tile.appendChild(img);
          }

          if (structureEnabled && structuresData[coord]) {
            const mark = document.createElement('div');
            mark.className = 'marker';
            mark.textContent = structuresData[coord].type === 'fort' ? 'üè∞' :
                               structuresData[coord].type === 'ruin' ? 'üèö' : 'üè†';
            tile.appendChild(mark);
          }

          if (loreEnabled && loreData[coord] && (!fogEnabled || discovered)) {
            tile.title = loreData[coord].title + ": " + loreData[coord].text;
          }

          
          if (relicsData[coord] && (!fogEnabled || discovered)) {
            const mark = document.createElement('div');
            mark.className = 'marker';
            mark.textContent = '‚ú®';
            tile.appendChild(mark);
            tile.title = relicsData[coord].name + ' ‚Äî ' + (relicsData[coord].lore || '');
            tile.style.border = '2px solid gold';
          }

          
          // Weather overlay icon
          if (weatherData[coord]) {
            const w = weatherData[coord];
            const wIcon = document.createElement('div');
            wIcon.style.position = 'absolute';
            wIcon.style.top = '0';
            wIcon.style.right = '0';
            wIcon.style.fontSize = '12px';
            wIcon.innerText =
              w.condition === 'sun' ? '‚òÄÔ∏è' :
              w.condition === 'rain' ? 'üåßÔ∏è' :
              w.condition === 'fog' ? 'üå´Ô∏è' :
              w.condition === 'storm' ? '‚õàÔ∏è' :
              w.condition === 'snow' ? '‚ùÑÔ∏è' : '';
            wIcon.title = `${w.condition.charAt(0).toUpperCase() + w.condition.slice(1)} ‚Äî ${w.intensity} ‚Äî ${w.temp}¬∞F`;
            div.appendChild(wIcon);
          }

          container.appendChild(tile);
        }
      }
    }

    function toggleFog() {
      fogEnabled = !fogEnabled;
      try { relicsData = await fetch("relics.json").then(r => r.json()); } catch { relicsData = {}; }
      try { weatherData = await fetch("weather.json").then(r => r.json()); } catch { weatherData = {}; }
      buildMasterMap();
    }
    function toggleLore() {
      loreEnabled = !loreEnabled;
      try { relicsData = await fetch("relics.json").then(r => r.json()); } catch { relicsData = {}; }
      try { weatherData = await fetch("weather.json").then(r => r.json()); } catch { weatherData = {}; }
      buildMasterMap();
    }
    function toggleStructures() {
      structureEnabled = !structureEnabled;
      try { relicsData = await fetch("relics.json").then(r => r.json()); } catch { relicsData = {}; }
      try { weatherData = await fetch("weather.json").then(r => r.json()); } catch { weatherData = {}; }
      buildMasterMap();
    }

    loadMap();
  </script>
</body>
</html>
